{% extends "base.html" %}

{% block content %}
<h2 class="title">
  Welcome, {{ name }}!
</h2>
<h4 class="title">Your Requests</h4>
<div class="container" id="request-form">
  {% for req in reqs %}
    {% if req.poster == name %}
      <div class="row mb-4">
        <div class="col-11 p-3">
          <div class="request">
            <div class="container p-4">
              <div class="row">
                {% if req.image %}
                  <div class="col-sm-3 px-1">
                    <img src="{{ url_for('static', filename='uploads/' + req.image) }}" class="img-fluid mb-3" id="request-image">
                  </div>
                {% endif %}
                <div class="col-sm-9 px-1">
                  <h4 id="subtitle">{{ req.title }}</h4>
                  <p>{{ req.content }}</p>
                </div>
              </div>

              <div class="row">
                <div class="col align-self-start">
                  <a href="{{ url_for('main.editrequest', id=req.id) }}" class="btn btn-outline-primary btn-sm">Edit</a>
                </div>
                <div class="col align-self-end text-end">
                  <p style="font-style: italic;">Posted by {{ req.poster }} on {{ req.time_created }}</p>
                </div>
              </div>
              <hr>

              <!-- Display comments -->
              <h5 id="subtitle">Comments:</h5>
              <hr>
              {% for comment in req.comments %}
                <div class="media mb-3">
                  <div class="media-body">
                    <h6 class="mt-0">{{ comment.poster }} <small class="text-muted">{{ comment.time_created }}</small></h6>
                    <p>{{ comment.content }}</p>
                    {% if comment.poster == name %}
                      <form action="{{ url_for('main.delete_comment', id=comment.id) }}" method="POST" class="d-inline">
                        <input type="submit" value="Delete" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this comment?')">
                      </form>
                    {% endif %}
                  </div>
                </div>
              {% endfor %}
              <hr>
              <!-- Comment form -->
              <form action="{{ url_for('main.add_comment', req_id=req.id) }}" method="POST">
                {{ comment_form.hidden_tag() }}
                <div class="form-group">
                  {{ comment_form.comment_content(class="form-control", rows=1, placeholder="Write a comment...") }}
                </div>
                <button type="submit" class="misc-btn">Post Comment</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  {% endfor %}
</div>
{% endblock %}
