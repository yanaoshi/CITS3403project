{% extends "base.html" %}

{% block content %}
<h1 class="title">
  Welcome, {{ name }}!
</h1>
<h3 class="title">Your Requests</h3>
{% for req in reqs %}
  {% if req.poster == name %}
    <div class='request'>
      <h4>{{ req.title }}</h4>
      <p>{{ req.content }}</p>
      {% if req['image'] != None %}
        <img src="{{ url_for('static', filename='uploads/' + req['image']) }}" width="200px" height="200px">
        <br>
      {% endif %}
      <p>Posted by: {{ req.poster }}</p>
      <p>{{ req.time_created }}</p>
      <a href="{{ url_for('main.editrequest', id=req.id) }}">Edit</a>

      <!-- Comment form -->
      <form action="{{ url_for('main.add_comment', req_id=req.id) }}" method="POST">
        <textarea name="comment_content" placeholder="Respond to the request"></textarea>
        <button type="submit">Respond</button>
      </form>

      <!-- Display comments -->
      <h5>Comments:</h5>
      {% for comment in req.comments %}
        <hr>
        <b>{{ comment.poster }} says:</b>
        <p>{{ comment.content }}</p>
        <p>{{ comment.time_created }}</p>
        {% if comment.poster == name %}
          <form action="{{ url_for('main.delete_comment', id=comment.id) }}" method="POST">
            <input type="submit" value="Delete"
            onclick="return confirm('Are you sure you want to delete this comment?')">
          </form>
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}
{% endfor %}
{% endblock %}