{% extends "base.html" %}

{% block content %}
  <h2 class="title">
    View Requests
  </h2>
  <!--Sort and search buttons-->
  <div class="container">
    <div class="row">
      <div class="col-sm-2">
        <form action="{{ url_for('main.sortrequests', sorting_method='newest') }}" method="POST">
          <input class="form-control form-control-md" type="submit" value="Sort by Newest" onclick>
        </form>
      </div>
      <div class="col-sm-2">
        <form action="{{ url_for('main.sortrequests', sorting_method='oldest') }}" method="POST">
          <input class="form-control" type="submit" value="Sort by Oldest" onclick>
        </form>
      </div>
      <div class="col-sm-4 justify-content-end">
        <form action="{{ url_for('main.viewrequests') }}" id="search-requests" method="POST">
          <input class="form-control" type="text" name="search" 
          placeholder="Search requests..." value="{{ request.form['keywords'] }}">
      </div>
          <button type="submit" class="btn btn-secondary">Search</button>
        </form>
    </div>
  </div>
  <br>
  <!--Request boxes-->
  <div class="container">
    {% for req in reqs %}
      <div class="row">
        <div class="col-11 p-3">
          <div class='request'>
            <div class="container p-4">
              <div class="row">
                {% if req['image'] != None %}
                  <div class="col-sm-3 px-1">
                      <img src="{{ url_for('static', filename='uploads/' + req['image']) }}"
                      class="img-fluid" id="request-image">
                      <br><br>
                  </div>
                {% endif %}
                <div class="col-sm-9 px-1">
                  <h4 id="subtitle">{{ req.title }}</h4>
                  <p>{{ req.content }}</p>
                </div>
              </div>

              <div class="row">
                <div class="col align-self-start">            
                {% if req.poster == name %}
                  <a href="{{ url_for('main.editrequest', id=req.id) }}">Edit</a>
                {% endif %}
                </div>
                <div class="col align-self-end">  
                  <p style="font-style: italic;">Posted by {{ req.poster }} on {{ req.time_created }}</p>
                </div>
              </div>

              <hr>
              <!-- Display comments -->
              <h5 id="subtitle">Comments:</h5>
              <hr>
              {% for comment in req.comments %}
                <b style="display:inline-block">{{ comment.poster }}&ensp;</b>
                <p id="time-date">{{ comment.time_created }}</p>
                <p>{{ comment.content }}</p>
                {% if comment.poster == name %}
                  <form action="{{ url_for('main.delete_comment', id=comment.id) }}" method="POST">
                    <input type="submit" value="Delete"
                    onclick="return confirm('Are you sure you want to delete this comment?')">
                  </form>
                {% endif %}
                <hr>
              {% endfor %}
              <br>
              <!-- Comment form -->
              <form action="{{ url_for('main.add_comment', req_id=req.id) }}" method="POST">
                <textarea name="comment_content" placeholder="Write a comment..." rows="1" cols="40"></textarea>
                <button class="misc-btn" type="submit">Post</button>
              </form>
            </div>
          </div>
        </div>
      </div>
  {% endfor %}
  </div>
{% endblock %}
